---
title: "Regression modelling of number of days with bad mental health"
output: 
 html_document:
    toc: true
    toc_float: true
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggplot2)
library(survey)
library(srvyr)
#library(svyVGAM)
library(readr)
library(forcats)
library(gtsummary)

# Set options for allowing a single observation per stratum 
options(survey.lonely.psu = "adjust")
```


```{r include = FALSE}
load(file = "./data/brfss_design.Rdata")
```


### Crude model with exposures only
```{r}
svyglm(mh_bin ~ sex + children, # exposures
       brfss_design,
       family = quasibinomial()) %>%
  broom::tidy(exponentiate=T, conf.int = T, conf.level=0.95)
```

### Model controlling for demographic variables
```{r}
svyglm(mh_bin ~ sex + children + # exposures
         race + age + marital_status, # demographic covariates
       brfss_design,
       family = quasibinomial()) %>%
  broom::tidy(exponentiate=T, conf.int = T, conf.level=0.95)
```

### Model controlling for demographic and socioeconomic variables
```{r}
svyglm(mh_bin ~ sex + children + # exposures
         race + age + marital_status + # demographic covariates
         education + income + employment, # socioeconomic covariates, 
       brfss_design,
       family = quasibinomial()) %>%
  broom::tidy(exponentiate=T, conf.int = T, conf.level=0.95)
```


### Model controlling for demographic, socioeconomic, and health variables
```{r}
svyglm(mh_bin ~ sex + children + # exposures
           race + age + marital_status + # demographic covariates
           education + income + employment + # socioeconomic covariates
           general_health + exercise, # health-related covariates
       brfss_design,
       family = quasibinomial())  %>%
  broom::tidy(exponentiate=T, conf.int = T, conf.level=0.95)
```

### Subsetted analysis by gender
Here we are intereted in our second exposure, the number of children in the household. Specifically, we are interested in if it affects the self-reported number of days with bad mental health days differently for men and women. 

For male: 
```{r}
 brfss_male = brfss_design %>%
   filter(sex == "male")
 
 svyglm(mh_bin ~ children + # exposures
            race + age + marital_status + # demographic covariates
            education + income + employment + # socioeconomic covariates
            general_health + exercise, # health-related covariates
        brfss_male,
        family = quasibinomial())  %>%
   broom::tidy(exponentiate=T, conf.int = T, conf.level=0.95)
```

For female:
```{r}
 brfss_female = brfss_design %>%
   filter(sex == "female")
 
 svyglm(mh_bin ~ children + # exposures
            race + age + marital_status + # demographic covariates
            education + income + employment + # socioeconomic covariates
            general_health + exercise, # health-related covariates
        brfss_female,
        family = quasibinomial())  %>%
   broom::tidy(exponentiate=T, conf.int = T, conf.level=0.95)
```

From subsetted regression, we can conclude that the number of children influences women and men in different ways because the p value for women now is much less than 0.05.







