---
title: "State-level Explorations"
html_document:
    toc: true
    toc_float: true
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggplot2)
library(survey)
library(srvyr)
library(readr)
library(forcats)
library(gtsummary)

# Set options for allowing a single observation per stratum 
options(survey.lonely.psu = "adjust")

```

```{r include = FALSE}
load(file = "./data/brfss_design.Rdata")
```


```{r include = FALSE}
depr_prev_bystate_gender = brfss_design %>%
  group_by(state_code, sex, depression) %>%
  summarize(depression_prev = 100*survey_mean(na.rm = T, vartype = c("ci")))

```

### State-level gender differences in mental health outcomes

For a dash board of the geographical distribution of the two mental health outcomes, click here (insert link later).

Below is a grouped barplot of the prevalence of self-reported past diagnosis of depression by gender in each US state, arranged in descending order by the value of this estimate among women. We can see that this prevalence among women is the highest in West Virginia and lowest in Hawaii. Interestingly, this prevalence among men did not show a decrease as obvious as that among women in this plot.

```{r}
sorted_depr_prev = depr_prev_bystate_gender %>%
  filter(depression == "yes", sex == "female") %>%
  arrange(desc(depression_prev)) %>%
  mutate(state_code = factor(state_code))

depr_prev_bystate_gender %>% 
  filter(depression == "yes") %>%
  mutate(state_code = factor(state_code, levels = sorted_depr_prev$state_code, ordered = TRUE)) %>% 
  ggplot(aes(x = state_code, y = depression_prev, fill = sex), group = state_code) +
  geom_bar(stat="identity", width=.5, position = "dodge")  +
  theme(axis.text.x = element_text(angle = 90, hjust = 1),
        legend.position = "bottom") +
  labs(x = "state", y = "prevalence (%)",
       title = "Prevalence of self-reported past diagnosis of depression by gender in each US state")
```

