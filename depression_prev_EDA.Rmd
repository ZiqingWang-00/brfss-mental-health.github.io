---
title: "On prevalence of self-reported depression diagnosis"
output: 
  html_document:
    toc: true
    toc_float: true
    code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggplot2)
library(survey)
library(srvyr)
library(readr)
library(forcats)
library(gtsummary)

# Set options for allowing a single observation per stratum 
options(survey.lonely.psu = "adjust")
```

```{r include = FALSE}
# load survey design object
load(file = "./data/brfss_design.Rdata")
```

### Summary statistics

Below is the unweighted counts of the all included demographic variables, exposure, and other covariates, dichotomized by whether they self-reported whether they've ever been told by a physician that they had depression.  

```{r}
tb1_unweighted_depr =
  brfss_design$variables %>%
  tbl_summary(by = depression, percent = "row", 
              include = c(sex, race, age, marital_status,
                             children,
                             education, income, employment,
                             general_health, exercise),
              type = list(exercise ~ "categorical"))

tb1_unweighted_depr
```
We make the following observations about the above summary counts:

* Prevalence of self-reported depression is higher in women than men.
* Asians are the least likely to self-report depression, while whites and people of race/ethnicities other than white, black, Asian, and Hispanic are the most likely to self-report depression. 
* Prevalence of self-reported depression among young people is higher than older people.
* Prevalence of self-reported depression is higher among those who are not married. 
* It seems like the number of children in the household is not correlated to self-reported depression. 
* People with higher education level and higher income are less likely to self-report depression.
* Unemployed people are more likely to report depression than employed people.
* People who report less than excellent health and who haven't had any physical exercise in the past 30 days have higher prevalence of self-reported depression. 

Below is the weighted summary counts:
```{r}
tb1_weighted_depr =
  brfss_design %>%
  tbl_svysummary(by = depression, percent = "row", 
                 include = c(sex, race, age, marital_status,
                             children,
                             education, income, employment,
                             general_health, exercise),
                  type = list(exercise ~ "categorical"))

tb1_weighted_depr
```

We can see that the same observations above hold in the weighted summary counts.  

We take closer looks at how gender might interact with the following demographic variables to affect self-reported depression:  

### Gender, number of children in family, and depression**74**
We are interested in the differential impact of the number of children in the household on self-reported depression among men and women. Below is a barplot on this topic:

```{r}
brfss_design %>%
  group_by(sex, children, depression) %>%
  summarize(depression_prev = 100*survey_mean(na.rm = T, vartype = c("ci"))) %>%
  filter(!is.na(children), depression == "yes") %>%
  select(-depression) %>%
  ggplot(aes(x = children, y = depression_prev, fill = sex)) +
  geom_bar(position="dodge", stat="identity") +
  geom_errorbar(aes(ymin=depression_prev_low, ymax=depression_prev_upp), 
                width=.2, position=position_dodge(.9))

```

One interesting observation is that men who have children in the household have significantly lower prevalence of self-reported depression while women who have children don't. We do a chi-square test incorporating the survey weights to verify this observation:
```{r}
# For women
brfss_design %>%
  filter(sex == "female") %>% 
  select(children, depression) %>% 
  svychisq(~children + depression, . , statistic="adjWald") %>% 
  broom::tidy()

brfss_design %>%
  filter(sex == "male") %>% 
  select(children, depression) %>% 
  svychisq(~children + depression, . , statistic="adjWald") %>% 
  broom::tidy()
```
As expected, based on the chi-squared test, the number of children in the household is significantly associated with self-reported depression among men but not women. 

### Gender, race, and depression**107**
Next, we examine how gender and race together associate with self-reported depression. 
```{r}
brfss_design %>%
  group_by(sex, race, depression) %>%
  summarize(depression_prev = 100*survey_mean(na.rm = T, vartype = c("ci"))) %>%
  filter(!is.na(race), depression == "yes") %>%
  select(-depression) %>%
  ggplot(aes(x = race, y = depression_prev, fill = sex)) +
  geom_bar(position="dodge", stat="identity") +
  geom_errorbar(aes(ymin=depression_prev_low, ymax=depression_prev_upp), 
                width=.2, position=position_dodge(.9))
```
We can see that not only is the prevalence of self-reported depression higher in women than men, the same holds true for all race/ethnicities included in the data set.

### Gender, age, and depression**122**
```{r}
brfss_design %>%
  group_by(sex, age, depression) %>%
  summarize(depression_prev = 100*survey_mean(na.rm = T, vartype = c("ci"))) %>%
  filter(!is.na(age), depression == "yes") %>%
  select(-depression) %>%
  ggplot(aes(x = age, y = depression_prev, fill = sex)) +
  geom_bar(position="dodge", stat="identity") +
  geom_errorbar(aes(ymin=depression_prev_low, ymax=depression_prev_upp), 
                width=.2, position=position_dodge(.9))
```
Based on the plot above, it seems that, for women, the prevalence of self-reported depression remains stable between age group 30-49 and 50-64, but decreases significantly between age group 18-29 and 30-49 as well as between age group 50-64 and 65+. The same trend is displayed among men as well but in smaller magnitude.  

This gap in the magnitude of change in prevalence of self-reported depression indicates that aging might affect self-reported depression among women and men differently. 

### Gender, exercise and depression**138**

Next, we want to examine the influence of exercise on depression in among women and men.

```{r}
brfss_design %>%
  group_by(sex, exercise, depression) %>%
  summarize(depression_prev = 100*survey_mean(na.rm = T, vartype = c("ci"))) %>%
  filter(!is.na(exercise), depression == "yes") %>%
  select(-depression) %>%
  ggplot(aes(x = exercise, y = depression_prev, fill = sex)) +
  geom_bar(position="dodge", stat="identity") +
  geom_errorbar(aes(ymin=depression_prev_low, ymax=depression_prev_upp), 
                width=.2, position=position_dodge(.9))

```

